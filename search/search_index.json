{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"API Proxy","text":"<ul> <li>Documenta\u00e7\u00e3o: https://fernandocelmer.github.io/api-proxy/</li> <li>C\u00f3digo Fonte: https://github.com/FernandoCelmer/api-proxy</li> </ul>"},{"location":"#sumario","title":"Sum\u00e1rio","text":"<ul> <li>Projeto<ul> <li>Fluxo do Projeto</li> <li>Estrutura de Permiss\u00f5es</li> <li>Tecnologias e Ferramentas</li> <li>Execu\u00e7\u00e3o</li> <li>Teste</li> </ul> </li> <li>Documenta\u00e7\u00e3o<ul> <li>MkDocs</li> <li>Swagger</li> </ul> </li> <li>Configura\u00e7\u00f5es<ul> <li>Ambiente Virtual Python</li> <li>Variaveis de Ambiente</li> </ul> </li> <li>Monitoramento<ul> <li>Prometheus</li> </ul> </li> </ul>"},{"location":"#melhorias","title":"Melhorias","text":"<ul> <li>\ud83d\udccc ISSUE-3: Add Docstring to classes and functions to improve understanding</li> <li>\ud83d\udccc ISSUE-2: Create unit tests</li> <li>\ud83d\udccc ISSUE-1: Implement required features for MongoDB database</li> </ul>"},{"location":"#padroes-de-commits","title":"Padr\u00f5es de Commits","text":"<ul> <li>\u2699\ufe0f FEATURE</li> <li>\ud83d\udcdd PEP8</li> <li>\ud83d\udccc ISSUE</li> <li>\ud83e\udeb2 BUG</li> <li>\ud83d\udcd8 DOCS</li> <li>\ud83d\udce6 PyPI</li> <li>\u2764\ufe0f\ufe0f TEST</li> <li>\u2b06\ufe0f CI/CD</li> <li>\u26a0\ufe0f SECURITY</li> </ul>"},{"location":"#licenca","title":"Licen\u00e7a","text":"<p>Este projeto \u00e9 licenciado sob os termos da licen\u00e7a MIT.</p>"},{"location":"nav/documentation/mkdocs/","title":"Mkdocs","text":"<p>O MkDocs \u00e9 uma ferramenta que auxilia na documenta\u00e7\u00e3o de projetos gerando  p\u00e1ginas de site est\u00e1tico (SSG \u2013 Static Site Generators) r\u00e1pido e simples.</p>"},{"location":"nav/documentation/mkdocs/#acesso","title":"Acesso","text":"<ul> <li>Link: http://127.0.0.1:8000</li> </ul>"},{"location":"nav/documentation/mkdocs/#configuracoes","title":"Configura\u00e7\u00f5es","text":""},{"location":"nav/documentation/mkdocs/#instalando-mkdocs","title":"Instalando MkDocs","text":"<p>Para instalar o MkDocs, execute o seguinte comando no seu terminal:</p> <pre><code>pip install mkdocs\n</code></pre>"},{"location":"nav/documentation/mkdocs/#execucao","title":"Execu\u00e7\u00e3o","text":"<p>Execute o servidor de desenvolvimento integrado</p> <pre><code>mkdocs serve\n</code></pre>"},{"location":"nav/documentation/swagger/","title":"Swagger","text":"<p>O Swagger \u00e9, basicamente, um conjunto de ferramentas que nos ajuda a fazer o design, ou seja, fazer a modelagem, a documentar e at\u00e9 gerar c\u00f3digo para desenvolvimento de APIs.</p>"},{"location":"nav/documentation/swagger/#acesso","title":"Acesso","text":"<ul> <li>Link: http://127.0.0.1:8000/docs</li> </ul>"},{"location":"nav/monitoring/prometheus/","title":"Prometheus","text":"<p>O Prometheus coleta e armazena suas m\u00e9tricas como dados de s\u00e9ries temporais, ou seja, as informa\u00e7\u00f5es das m\u00e9tricas s\u00e3o armazenadas com o carimbo de data/hora em que foram registradas, juntamente com pares chave-valor opcionais chamados r\u00f3tulos.</p>"},{"location":"nav/monitoring/prometheus/#acesso","title":"Acesso","text":"<ul> <li>Link: http://127.0.0.1:9090/</li> </ul>"},{"location":"nav/monitoring/prometheus/#configuracoes","title":"Configura\u00e7\u00f5es","text":""},{"location":"nav/monitoring/prometheus/#importacao","title":"Importa\u00e7\u00e3o","text":"<p>Importar a classe Counter. Utilizada para realizar a contagem de acessos em determinado endpoint da API.</p> <pre><code>from prometheus_client import Counter\n</code></pre>"},{"location":"nav/monitoring/prometheus/#criacao-funcao","title":"Cria\u00e7\u00e3o Fun\u00e7\u00e3o","text":"<p>Criar e especificar uma m\u00e9trica, que ser\u00e1 usado de controle para consulta no painel do Prometheus.</p> <pre><code>metric_hello_world = Counter('v1_metric_hello_world', 'API', ['method'])\n</code></pre>"},{"location":"nav/monitoring/prometheus/#utilizacao","title":"Utiliza\u00e7\u00e3o","text":"<p>Incluir essa m\u00e9trica no endpoint.</p> <pre><code>@app.get(\"/\")\nasync def root():\n    metric_hello_world.labels(method=\"GET\").inc()\n    return {\"message\": \"Hello World\"}\n</code></pre>"},{"location":"nav/monitoring/prometheus/#filtro","title":"Filtro","text":"<pre><code>get_total{job=\"proxy-api\", client=\"172.16.238.1\"}\n</code></pre>"},{"location":"nav/project/context/","title":"Contexto do Projeto","text":"<p>Uma empresa possui atualmente +30.000 servidores onde suas aplica\u00e7\u00f5es s\u00e3o executadas. Elas comunicam-se entre si atrav\u00e9s de <code>APIs</code>, sendo que algumas possuem ainda acesso externo (api.empresa.com).</p>"},{"location":"nav/project/context/#problema","title":"Problema","text":"<p>Um dos problemas \u00e9 a dificuldade para medir e controlar interconex\u00f5es entre as <code>APIs</code>.</p>"},{"location":"nav/project/context/#solucao","title":"Solu\u00e7\u00e3o","text":"<p>Implementa\u00e7\u00e3o de um <code>Proxy de APIs</code> com os seguintes requisitos:</p> <ul> <li>Executar a fun\u00e7\u00e3o de proxy sobre o dom\u00ednio api.empresa.com, isto \u00e9, ele deve agir como um intermedi\u00e1rio para as requisi\u00e7\u00f5es dos clientes, enviando-as \u00e0 api.empresa.com.</li> <li>Dever\u00e1 permitir o controle das quantidades m\u00e1ximas de requisi\u00e7\u00f5es por:<ul> <li>IP de origem</li> <li>Path de destino</li> <li>Combina\u00e7\u00f5es de ambos</li> </ul> </li> <li>Deve armazenar (e tamb\u00e9m permitir que se consulte) as estat\u00edsticas de uso do proxy.</li> <li>O proxy (como solu\u00e7\u00e3o) dever\u00e1 poder superar 50.000 requisi\u00e7\u00f5es por segundo.</li> </ul>"},{"location":"nav/project/execution/","title":"Execu\u00e7\u00e3o","text":"<p>Para a execu\u00e7\u00e3o do projeto foi configurado um ambiente pronto para utiliza\u00e7\u00e3o a partir de <code>containers</code>, onde s\u00e3o executados as duas aplica\u00e7\u00f5es, <code>API Proxy</code> e <code>Prometheus</code> com informa\u00e7\u00f5es pr\u00e9-carregadas.</p>"},{"location":"nav/project/execution/#dependencias","title":"Depend\u00eancias","text":"<ul> <li>Git</li> <li>Docker</li> <li>Docker Compose</li> </ul> OS Package Manager Command linux Pacman <code>pacman -S docker docker-compose git</code>"},{"location":"nav/project/execution/#etapas","title":"Etapas","text":""},{"location":"nav/project/execution/#download","title":"Download","text":"<p>Clonar o reposit\u00f3rio api-proxy, dispon\u00edvel no Github.</p> <pre><code>git clone https://github.com/FernandoCelmer/api-proxy.git\n</code></pre>"},{"location":"nav/project/execution/#construcao","title":"Constru\u00e7\u00e3o","text":"<p>Comando para construir ou reconstruir servi\u00e7os. Mais informa\u00e7\u00f5es na documenta\u00e7\u00e3o oficial -&gt; docker compose build</p> <pre><code>docker-compose build\n</code></pre>"},{"location":"nav/project/execution/#execucao_1","title":"Execu\u00e7\u00e3o","text":"<p>Comando que constr\u00f3i, (re)cria, inicia e anexa a cont\u00eaineres para um servi\u00e7o. Mais informa\u00e7\u00f5es na documenta\u00e7\u00e3o oficial -&gt; docker compose up</p> <pre><code>docker-compose up\n</code></pre>"},{"location":"nav/project/flow/","title":"Fluxo do Projeto","text":"<pre><code>sequenceDiagram\n    Cliente-&gt;&gt;+Proxy-Endpoint: Realiza uma opera\u00e7\u00e3o HTTP no [Proxy]\n    Proxy-Endpoint-&gt;&gt;+Prometheus: [Proxy] busca informa\u00e7\u00f5es de IP/Path\n    Prometheus--&gt;&gt;-Proxy-Endpoint: Responde informa\u00e7\u00f5es de IP/Path\n    Proxy-Endpoint-&gt;&gt;+Target-Endpoint: Realiza uma opera\u00e7\u00e3o HTTP no [Target]\n    Target-Endpoint--&gt;&gt;-Proxy-Endpoint: [Target] responde solicita\u00e7\u00e3o\n    Proxy-Endpoint--&gt;&gt;-Cliente: [Proxy] responde solicita\u00e7\u00e3o\n    loop Busca M\u00e9tricas\n        Prometheus-&gt;&gt;+Proxy-Endpoint: [Proxy] envia solicita\u00e7\u00e3o\n        Proxy-Endpoint--&gt;&gt;-Prometheus: [Proxy] responde solicita\u00e7\u00e3o\n    end</code></pre>"},{"location":"nav/project/flow/#resumo","title":"Resumo","text":"<p>Basicamente o projeto todo se resume na comunica\u00e7\u00e3o entre duas aplica\u00e7\u00f5es que se dividem entre o processamento de solicita\u00e7\u00f5es <code>HTTP</code> e no armazenamento de m\u00e9tricas de usu\u00e1rios.</p>"},{"location":"nav/project/flow/#api-proxy","title":"API Proxy:","text":"<p>Respons\u00e1vel pela maior parte das opera\u00e7\u00f5es envolvendo o <code>cliente</code> final que pode tanto ser servi\u00e7os internos como externos. Esta <code>API</code> ir\u00e1 receber qualquer solicita\u00e7\u00e3o <code>HTTP</code> do <code>cliente</code> e realizar\u00e1 o processamento do mesmo que envolve:</p> <ul> <li>Valida\u00e7\u00e3o de <code>Path</code>/<code>Endpoint</code> se existe nas configura\u00e7\u00f5es.</li> <li>Valida\u00e7\u00e3o de <code>IP</code> referente ao <code>cliente</code> que est\u00e1 fazendo esta opera\u00e7\u00e3o.<ul> <li>Se IP est\u00e1 cadastrado nas permiss\u00f5es.</li> <li>Se existe v\u00ednculo entre <code>IP</code> &lt;-&gt; <code>Path</code></li> <li>Se j\u00e1 ultrapassou o limite de solicita\u00e7\u00e3o com base nas configura\u00e7\u00f5es do <code>cliente</code>.</li> <li>Se j\u00e1 ultrapassou o limite de solicita\u00e7\u00e3o com base nas configura\u00e7\u00f5es do <code>proxy</code>.</li> </ul> </li> </ul>"},{"location":"nav/project/flow/#prometheus","title":"Prometheus","text":"<p>Respons\u00e1vel por fornecer a estrutura de armazenamento e plotagem de dados referente as solicita\u00e7\u00f5es HTTP do <code>Proxy</code>. Com o <code>Prometheus</code> \u00e9 poss\u00edvel de forma bastante f\u00e1cil e r\u00e1pida visualizar os dados atrav\u00e9s de um dashboard e implementar integra\u00e7\u00f5es com outras plataformas atrav\u00e9s da <code>API</code>. </p> <p>Para manter os dados atualizados o <code>Promotheus</code> realiza solicita\u00e7\u00f5es HTTP ao <code>Proxy</code> de tempos em tempos para buscar as \u00faltimas m\u00e9tricas. O tempo entre cada solicita\u00e7\u00e3o \u00e9 totalmente configur\u00e1vel, atualmente para este projeto est\u00e1 definido por padr\u00e3o 15 segundos.</p>"},{"location":"nav/project/permissions-structure/","title":"Estrutura de Permiss\u00f5es","text":"<p>Inicialmente para este projeto foi pensado em n\u00e3o usar um banco de dados relacional como <code>MySQL</code>, j\u00e1 pensando nos problemas comuns que no futuro pederiam acontecer como a quest\u00e3o do <code>Deadlock</code> (Deadlock \u00e9 o termo utilizado para designar um erro que acontece quando duas sess\u00f5es entram numa situa\u00e7\u00e3o de conflito, cada qual aguardando pela libera\u00e7\u00e3o de bloqueios que a outra sess\u00e3o mant\u00e9m) com as poss\u00edveis milhares de solicita\u00e7\u00f5es a API por segundo.</p> <p>Uma das alternativas pensadas ao banco de dados <code>MySQL</code> foi o <code>MongoDB</code> que \u00e9 um banco de dados n\u00e3o relacional, para suprir a demanda de armazenamento de informa\u00e7\u00f5es de <code>Proxys</code>, <code>Clientes</code> e <code>Permiss\u00f5es</code>.</p> <p>Mas para n\u00e3o deixar muito complexo a parte inicial do projeto foi definido dentro do projeto dois arquivos de configura\u00e7\u00e3o, um para os <code>Proxys</code> e o outro para o <code>Cliente</code>, esse foi um modo de pelo menos padronizar uma estrura de permiss\u00f5es que podem no futuro ser reutilizadas ou integradas com outros tipos de base de dados.</p>"},{"location":"nav/project/permissions-structure/#configuracao-proxy","title":"Configura\u00e7\u00e3o: Proxy","text":"<p>Path: <code>api-proxy/proxy/data/proxy.json</code></p> <pre><code>{\n\"gorest.co.in\": {\n\"scheme\": \"https\",\n\"host\": \"gorest.co.in\",\n\"paths\": [\n{\n\"path\": \"/public/v2/users\",\n\"max_request\": 10,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/users/{ID}\",\n\"max_request\": 10,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/posts\",\n\"max_request\": 5,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/comments\",\n\"max_request\": 25,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/todos\",\n\"max_request\": 50,\n\"time_stamp\": 60\n}\n]\n}\n}\n</code></pre> <p>Este arquivo de configura\u00e7\u00e3o tem como principal fun\u00e7\u00e3o armazenar informa\u00e7\u00f5es de <code>APIs</code> que o <code>Proxy</code> ir\u00e1 prover suporte a redirecionamento. \u00c9 uma estrutura com informa\u00e7\u00f5es b\u00e1sicas realizar as devidas opera\u00e7\u00f5es.</p>"},{"location":"nav/project/permissions-structure/#configuracao-client","title":"Configura\u00e7\u00e3o: Client","text":"<p>Path: <code>api-proxy/proxy/data/users.json</code></p> <pre><code>{\n\"172.16.238.1\": [\n{\n\"host\": \"gorest.co.in\",\n\"paths\": [\n{\n\"path\": \"/public/v2/users\",\n\"max_request\": 10,\n\"time_stamp\": 1\n},\n{\n\"path\": \"/public/v2/users/{ID}\",\n\"max_request\": 10,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/comments\",\n\"max_request\": 15,\n\"time_stamp\": 5\n}    ]\n}\n],\n\"127.0.0.1\": [\n{\n\"host\": \"gorest.co.in\",\n\"paths\": [\n{\n\"path\": \"/public/v2/users\",\n\"max_request\": 5,\n\"time_stamp\": 10\n},\n{\n\"path\": \"/public/v2/users/{ID}\",\n\"max_request\": 10,\n\"time_stamp\": 60\n},\n{\n\"path\": \"/public/v2/comments\",\n\"max_request\": 25,\n\"time_stamp\": 5\n}    ]\n}\n]\n}\n</code></pre> <p>Este arquivo cont\u00e9m informa\u00e7\u00f5es relacionadas ao <code>Cliente</code>, <code>Path</code> e quantidade m\u00e1xima permitida.</p>"},{"location":"nav/project/technologies/","title":"Tecnologias e Ferramentas","text":""},{"location":"nav/project/technologies/#linguagem-base","title":"Linguagem Base","text":"<ul> <li>Python</li> </ul>"},{"location":"nav/project/technologies/#framework-base-para-api","title":"Framework Base para API","text":"<ul> <li>FastAPI</li> </ul>"},{"location":"nav/project/technologies/#banco-de-dados","title":"Banco de Dados","text":"<ul> <li>LevelDB</li> </ul>"},{"location":"nav/project/technologies/#ferramentas-de-documentacao","title":"Ferramentas de Documenta\u00e7\u00e3o","text":"<ul> <li>Swagger</li> <li>MkDocs</li> </ul>"},{"location":"nav/project/technologies/#ferramentas-de-monitoramento","title":"Ferramentas de Monitoramento","text":"<ul> <li>Prometheus</li> </ul>"},{"location":"nav/project/test/","title":"Teste","text":"<p>Para o teste do projeto foi configurado uma s\u00e9rie de <code>collections</code> que podem ser importadas no <code>Postman</code> para facilitar o envio de solicita\u00e7\u00f5es HTTP diretamente ao <code>Proxy</code> local com informa\u00e7\u00f5es referente a <code>URLs</code> pr\u00e9viamente adicionadas e alinhadas ao projeto.</p>"},{"location":"nav/project/test/#dependencias","title":"Depend\u00eancias","text":"<ul> <li>Postman</li> </ul> OS Package Manager Command linux Snappy <code>sudo snap install postman</code>"},{"location":"nav/project/test/#arquivos","title":"Arquivos","text":""},{"location":"nav/project/test/#collection","title":"Collection","text":""},{"location":"nav/project/test/#caminho-no-projeto","title":"Caminho no Projeto","text":"<pre><code>api-proxy/docs/assets/postman_collection.json\n</code></pre>"},{"location":"nav/project/test/#download-curl","title":"Download Curl","text":"<pre><code>curl https://raw.githubusercontent.com/FernandoCelmer/api-proxy/master/docs/assets/postman_collection.json -o postman_collection.json\n</code></pre>"},{"location":"nav/project/test/#environment","title":"Environment","text":""},{"location":"nav/project/test/#caminho-no-projeto_1","title":"Caminho no Projeto","text":"<pre><code>api-proxy/docs/assets/postman_environment.json\n</code></pre>"},{"location":"nav/project/test/#download-curl_1","title":"Download Curl","text":"<pre><code>curl https://raw.githubusercontent.com/FernandoCelmer/api-proxy/master/docs/assets/postman_environment.json -o postman_environment.json\n</code></pre>"},{"location":"nav/settings/environment-variables/","title":"Variaveis de Ambiente","text":""},{"location":"nav/settings/environment-variables/#resumo","title":"Resumo","text":"<p>Como o pr\u00f3prio nome j\u00e1 diz uma vari\u00e1vel de ambiente \u00e9 uma vari\u00e1vel que existe no contexto do seu projeto, ou seja, se eu criar uma vari\u00e1vel de ambiente no meu computador ele n\u00e3o vai aparecer no seu computador.</p> <p>OBS: E principalmente n\u00e3o pode enviado para o reposit\u00f3rio do projeto, deve ser adicionado no projeto o mesmo ser executado em desenvolvimento, homologa\u00e7\u00e3o ou produ\u00e7\u00e3o.</p>"},{"location":"nav/settings/environment-variables/#criacao-variavel","title":"Cria\u00e7\u00e3o Vari\u00e1vel","text":"<p>Para criar as vari\u00e1veis de ambiente em seu projeto basta seguir o modelo de arquivo, disponibilizado na raiz do projeto chamado <code>.env-exemple</code>.</p> <p>Instru\u00e7\u00f5es:</p> <ul> <li>Copie o arquivo <code>.env-exemple</code></li> <li>Renomeia a c\u00f3pia de <code>.env-exemple-copy</code> para <code>.env</code></li> <li>Edite o arquivo <code>.env</code> com as informa\u00e7\u00f5es necess\u00e1rias</li> </ul>"},{"location":"nav/settings/environment-variables/#variaveis-proxy","title":"Vari\u00e1veis -&gt; proxy","text":""},{"location":"nav/settings/environment-variables/#lista-de-variaveis","title":"Lista de Vari\u00e1veis","text":"NOME Tipo Valor Exemplo DEBUG Integer 0 - 1 ENVIRONMENT String development - sandbox - production PROXY String ./proxy/data/proxy.json USERS String ./proxy/data/users.json URL_PROYX String http://127.0.0.1:8000 URL_PROMETHEUS String http://127.0.0.1:9090"},{"location":"nav/settings/environment-variables/#variaveis-prometheus","title":"Vari\u00e1veis -&gt; prometheus","text":""},{"location":"nav/settings/environment-variables/#lista-de-variaveis_1","title":"Lista de Vari\u00e1veis","text":"NOME Tipo Valor Exemplo"},{"location":"nav/settings/python-virtual-environment/","title":"Ambiente Virtual Python","text":""},{"location":"nav/settings/python-virtual-environment/#resumo","title":"Resumo","text":"<p>Um ambiente virtual \u00e9 uma maneira de voc\u00ea manter c\u00f3pias em uma pasta local seu interpretador Python. Dessa forma voc\u00ea pode instalar novos pacotes de Python em pastas espec\u00edficas e remov\u00ea-los facilmente apenas excluindo.</p>"},{"location":"nav/settings/python-virtual-environment/#criacao-ambiente","title":"Cria\u00e7\u00e3o Ambiente","text":"<ul> <li>Criar um novo ambiente virtual <pre><code>python -m venv venv\n</code></pre></li> <li>Ativando o ambiente virtual <pre><code>source venv/bin/activate\n</code></pre></li> </ul>"}]}